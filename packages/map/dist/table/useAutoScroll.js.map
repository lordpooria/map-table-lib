{"version":3,"sources":["../../src/table/useAutoScroll.ts"],"names":["SHIFT_SCROLL_INDEX","ITEM_SIZE","useAutoScroll","mainListRef","currentTimeIndex","state","setCurrentTimeIndex","actions","autoScroll","preventAutoScroll","setActiveRow","onScrolling","e","top","target","scrollTop","index","Math","floor","onScroll","current","onMouseDown","onMouseUp","onWheel","onPreventAutoScroll","releaseAutoScroll","onRowClick","scrollTo","behavior","counter","interval","setInterval","el","document","getElementById","MAIN_LIST_ID","clearInterval","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["import { MAIN_LIST_ID, useTableRowAction } from \"@hesaba/table\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { useTDStoreActions, useTDStoreState } from \"../store\";\n\ntype QuerySelectType = HTMLElement | null;\nconst SHIFT_SCROLL_INDEX = 2;\nconst ITEM_SIZE = 50;\n\nexport const useAutoScroll = () => {\n  const mainListRef = useRef<QuerySelectType>();\n  const currentTimeIndex = useTDStoreState((state) => state.currentTimeIndex);\n  const setCurrentTimeIndex = useTDStoreActions(\n    (actions) => actions.setCurrentTimeIndex\n  );\n  const autoScroll = useRef(true);\n  const preventAutoScroll = useRef(false);\n  const setActiveRow = useTableRowAction();\n\n  const onScrolling = useCallback((e) => {\n    const top = e?.target?.scrollTop;\n    if (!top) return;\n\n    setCurrentTimeIndex({\n      index: Math.floor(top / ITEM_SIZE) + SHIFT_SCROLL_INDEX,\n    });\n    // setCurrentTimeIndex()\n  }, []);\n  const onScroll = useCallback(\n    (e) => {\n      if (autoScroll.current) return;\n      onScrolling(e);\n    },\n    [onScrolling]\n  );\n\n  const onMouseDown = useCallback(() => {\n    autoScroll.current = false;\n  }, []);\n  const onMouseUp = useCallback(() => {\n    autoScroll.current = true;\n  }, []);\n\n  const onWheel = useCallback((e) => {\n    onPreventAutoScroll();\n    onScrolling(e);\n  }, []);\n\n  const onPreventAutoScroll = () => {\n    autoScroll.current = false;\n    preventAutoScroll.current = true;\n  };\n  const releaseAutoScroll = useCallback(() => {\n    preventAutoScroll.current = false;\n    autoScroll.current = true;\n  }, []);\n\n  const onRowClick = useCallback((index: number) => {\n    setCurrentTimeIndex({ index });\n    onPreventAutoScroll();\n  }, []);\n\n  const scrollTo = useCallback((index) => {\n    mainListRef.current?.scrollTo({\n      top: index * ITEM_SIZE,\n      behavior: \"smooth\",\n    });\n  }, []);\n\n  useEffect(() => {\n    if (autoScroll.current) {\n      scrollTo(currentTimeIndex);\n    }\n    setActiveRow(currentTimeIndex);\n    if (preventAutoScroll.current) {\n      releaseAutoScroll();\n    }\n  }, [currentTimeIndex]);\n\n  useEffect(() => {\n    let counter = 0;\n    const interval = setInterval(() => {\n      const el = document.getElementById(MAIN_LIST_ID);\n      counter++;\n      if (el || counter > 20) {\n        clearInterval(interval);\n        mainListRef.current = el;\n        mainListRef.current?.addEventListener(\"scroll\", onScroll);\n        mainListRef.current?.addEventListener(\"wheel\", onWheel);\n        mainListRef.current?.addEventListener(\"mousedown\", onMouseDown);\n        mainListRef.current?.addEventListener(\"mouseup\", onMouseUp);\n      }\n    }, 50);\n    return () => {\n      mainListRef.current?.removeEventListener(\"scroll\", onScroll);\n      mainListRef.current?.removeEventListener(\"wheel\", onWheel);\n      mainListRef.current?.removeEventListener(\"mousedown\", onMouseDown);\n      mainListRef.current?.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, []);\n\n  return onRowClick;\n};\n"],"file":"useAutoScroll.js"}