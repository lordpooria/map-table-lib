{"version":3,"sources":["../../src/store/util.ts"],"names":["seekNearestTimeIndex","_","formattedData","newIndex","length","getLowerLimit","upperLimit","availableTimes","getLowerLimitIndex","index","Math","min","max","getUpperLimit","lowerLimit","getUpperLimitIndex","setAvailableTime","mode","times","period","Date","parsedTimes","getCurrentTimeIndex","currentTimeIndex","getCurrentTime","loadingTimeIndex","checkSyncedLayersReady","time","syncedLayers","i","len","isReady"],"mappings":"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","sourcesContent":["import {\n  AvailableTimes,\n  FormattedData,\n  Mode,\n  Period,\n  SyncedLayer,\n} from \"../types/common\";\nimport {\n  explodeTimeRange,\n  intersect_arrays,\n  parseTimesExpression,\n  union_arrays,\n} from \"../utils/utils\";\n\nexport function seekNearestTimeIndex(\n  _: number,\n  formattedData: FormattedData\n) {\n  let newIndex = 0;\n  for (; newIndex < formattedData.length; newIndex++) {\n\n    // if (time < formattedData[newIndex][0].properties.time) {\n    //   break;\n    // }\n  }\n\n  // We've found the first index greater than the time. Return the previous\n  if (newIndex > 0) {\n    newIndex--;\n  }\n  return newIndex;\n}\n\nexport function getLowerLimit(\n  _: number,\n  upperLimit: number,\n  availableTimes: AvailableTimes\n) {\n \n  // var index = seekNearestTimeIndex(time, availableTimes);\n  return getLowerLimitIndex(0, upperLimit, availableTimes);\n}\n\nexport function getLowerLimitIndex(\n  index: number,\n  upperLimit: number,\n  availableTimes: AvailableTimes\n) {\n  return Math.min(\n    Math.max(index || 0, 0),\n    upperLimit || availableTimes.length - 1\n  );\n}\n\nexport function getUpperLimit(\n  _: number,\n  lowerLimit: number,\n  availableTimes: AvailableTimes\n) {\n  // var index = seekNearestTimeIndex(time, availableTimes);\n  return getUpperLimitIndex(0, lowerLimit, availableTimes);\n}\n\nexport function getUpperLimitIndex(\n  index: number,\n  lowerLimit: number,\n  availableTimes: AvailableTimes\n) {\n  return Math.max(Math.min(index, availableTimes.length - 1), lowerLimit || 0);\n}\nexport function setAvailableTime(\n  mode: Mode,\n  times: AvailableTimes | undefined,\n  period: Period,\n  availableTimes: AvailableTimes\n): AvailableTimes {\n  if (mode == \"extremes\" && times) {\n    return explodeTimeRange(\n      new Date(times[0]),\n      new Date(times[times.length - 1]),\n      period\n    );\n  } else {\n    const parsedTimes = parseTimesExpression(times, period);\n    if (availableTimes.length === 0) {\n      return parsedTimes;\n    } else if (mode == \"intersect\") {\n      return intersect_arrays(parsedTimes, availableTimes);\n    } else if (mode == \"union\") {\n      return union_arrays(parsedTimes, availableTimes);\n    } else if (mode == \"replace\") {\n      return parsedTimes;\n    } else {\n      throw \"Merge available times mode not implemented: \" + mode;\n    }\n  }\n}\n\nfunction getCurrentTimeIndex(\n  currentTimeIndex: number,\n  availableTimes: AvailableTimes\n) {\n  if (currentTimeIndex === -1) {\n    return availableTimes.length - 1;\n  }\n  return currentTimeIndex;\n}\n\nexport function getCurrentTime(\n  loadingTimeIndex: number,\n  currentTimeIndex: number,\n  availableTimes: AvailableTimes\n) {\n  var index = -1;\n  if (loadingTimeIndex !== -1) {\n    index = loadingTimeIndex;\n  } else {\n    index = getCurrentTimeIndex(currentTimeIndex, availableTimes);\n  }\n  if (index >= 0) {\n    return availableTimes[index];\n  } else {\n    return null;\n  }\n}\n\nexport function checkSyncedLayersReady(\n  time: number,\n  syncedLayers: SyncedLayer\n) {\n  for (var i = 0, len = syncedLayers.length; i < len; i++) {\n    if (syncedLayers[i].isReady) {\n      if (!syncedLayers[i].isReady(time)) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n"],"file":"util.js"}